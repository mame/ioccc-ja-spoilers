---
id: 2014/birken
year: 2014
order: 1
authors:
  - "Michael_Birken"
  - "Alexander_Prishchepov"
orig_url: "https://www.ioccc.org/2014/birken/prog.c"
hint_url: "https://www.ioccc.org/2014/birken/hint.html"
title: "IOCCC 2014: Best use of port 1701"
award_ja: "ポート1701の最高の使い方"
---

## 動作

メッセージ付きで起動すると、Webサーバになる。

```
$ gcc -trigraphs -o prog prog.c

$ echo "Hello, world!" | ./prog
```

[http://localhost:1701](http://localhost:1701)をブラウザで開くと、アスキーアートが出てくる。

{% include img.html src="2014-birken.png" desc="Webサーバにブラウザでアクセスした様子" %}

このサイトのソースを見ても、メッセージが埋め込まれている様子はない。
しかし別の端末から同じプログラムを次のように実行すると、隠されたメッセージが読み取れる。

```
$ ./prog http://127.0.0.1:1701
Hello, world!
```

メッセージはどのように隠されているだろうか？
メッセージは1秒に1文字ずつゆっくり出力されることがヒントとなっている。

## 解説

サーバはブラウザにもこのクライアントにも同じレスポンスを返している。
レスポンスの中にメッセージをエンコードしたものは一切含まれておらず、特定のリクエストのときだけ隠しメッセージを送るわけでもない。
どのように隠しメッセージを送っているか？というクイズになっている。

答えを言うと、レスポンスを返す時間を変えることで情報を送っている。
クライアントは何度も繰り返しリクエストを送る。
サーバは数字n（0～15）を送る場合、まずn回はウェイトなしでレスポンスを返し、その後0.5秒程度のウェイトをおいてレスポンスを返す（正確には、15を送る場合にはウェイトを省略する）。
このようにニブル単位でデータを送っていくとのこと。
ローカルで動かすWebサーバだからこそできるトリック。

プログラムは、アメリカの有名なSFドラマ、[スタートレック](https://ja.wikipedia.org/wiki/%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%83%AC%E3%83%83%E3%82%AF)を元ネタとしている。
コード形状は[クリンゴン](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%AA%E3%83%B3%E3%82%B4%E3%83%B3%E4%BA%BA)人が用いる宇宙船、[バード・オブ・プレイ](https://ja.wikipedia.org/wiki/%E3%83%90%E3%83%BC%E3%83%89%E3%83%BB%E3%82%AA%E3%83%96%E3%83%BB%E3%83%97%E3%83%AC%E3%82%A4)。
ポート1701は、宇宙船[エンタープライズ](https://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%97%E3%83%A9%E3%82%A4%E3%82%BA_%28%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%83%AC%E4%83%83%E3%82%AF%29)の登録番号"NCC-1701"を踏まえている（コード中では`#define NCC 1701`というマクロ定義になっている）。
このWebサーバが返すアスキーアートは、エンタープライズとバード・オブ・プレイの対決を表現しているとのこと（左がエンタープライズ、右がバード・オブ・プレイか）。
変数宣言が"Cpt. James T. Kirk and Odo"という順番になっていたり、`STARDATE`（宇宙暦）というマクロ名だったり。
スタートレックを知らないのでよくわかっていない。

コードの先頭に無意味なコメントが挿入されているのは、iocccsizeのバグをつくため。
[トライグラフ](https://ja.wikipedia.org/wiki/%E3%83%88%E3%83%A9%E3%82%A4%E3%82%B0%E3%83%A9%E3%83%95)による行継続でコメントの終端をわかりにくくしており、iocccsizeはコメントの終端を検出しそこねるため、サイズ0と誤報告する。
同作者は[[[2013/birken]]]({{ site.baseurl }}{% link 2013/birken.md %})でもiocccsizeのバグをつくことを行っていて、審査員自身が「よりよい方法がある」とコメントしたやりとりを踏まえている。
当時のバグは修正されたようだが、今回の作品はその修正が不完全であることを示したもの。
