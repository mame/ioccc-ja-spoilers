---
id: 2012/endoh1
year: 2012
order: 11
authors: "Yusuke_Endoh"
orig_url: "https://www.ioccc.org/2012/endoh1/endoh1.c"
hint_url: "https://www.ioccc.org/2012/endoh1/hint.html"
title: "IOCCC 2012: Most complex ASCII fluid - Honorable mention"
award_ja: "もっとも複雑なASCII流体 - 選外佳作"
---

## 動作

端末で流体シミュレーションをする。
水柱崩壊の例。

```
$ gcc endoh1.c -DG=1 -DP=4 -DV=8 -D_BSD_SOURCE -o endoh1 -lm

$ ./endoh1 < column.txt
```

```




        ,__.,___.
,_______/##||###\__.,.                                                 ,__.
|###/\#####||######\/|                                                 |##|
|##/\/#####||####|\\/\_.                                               |##|
|##\/######||####||#||/\.                                              |##|
|##\#######||###/\//\/|||                                              |##|
|##\#######||###||#||#|||                                              |##|
|##\#######||###||#||#|||                                              |##|
|##\#######||###||#||#|||                                              |##|
|##\#######||###||#||#|||                                              |##|
|##\#######||###||#||#\/|                                              |##|
|##\#######||###\/#\/|\#|                                              |##|
|##\#######||##|\#/\#||#|                                              |##|
|##########||##\/#\/|\/#\.                                             |##|
|###\#\####||##/\\##|||\|\.                                            |##|
|###\######||##\/|\#\/\/\/\_.                                          |##|
|###'#--'##||#|-\'|'\'\'-\'-'                                          |##|
|###\#\####\/#\_/\/\/\/\_/\____________________________________________/##|
`\#######################################################################/'
 `-----------------------------------------------------------------------'



```

```





,__.                                                                   ,__.
|##|                                                                   |##|
|##|                                                                   |##|
|##|                                                                   |##|
|##|                                                                   |##|
|##|                                                                   |##|
|##|                                                                   |##|
|##|,.,.,______.                                                       |##|
|##||||\/#####/\_.                                                     |##|
|##|/\/#\#####\/-\.,.    ,.                                            |##|
|##||\#\####\##\_/|/\__. |',.                                          |##|
|##|||#\\####|\#\#'\/\#|,/\/|,__.,.                                    |##|
|##|\/\##\\\#\###|\#\#\\/\#\\/##'/\____.                               |##|
|##\|\\/\#|##\#\\\###''#\\\#\|\\####\##\______.                        |##|
|###||\\/#\#'\\##|\#/'##/'###|/-'''\#/\\###/\#|,_.                     |##|
|###|/#\#|#'|#'-\'/'\\|\''#/-'\|#\/#\\/--'-\/\\/\',.                   |##|
|###\###\\##\##\#\#\/\\/###\#\#\##\\##\\/\_/###\/\/\___________________/##|
`\#######################################################################/'
 `-----------------------------------------------------------------------'



```

```





,__.                                                                   ,__.
|##|                                                                   |##|
|##|                                                                   |##|
|##|                                                                   |##|
|##|                                                            ,_.,.  |##|
|##|                                                   ,.    ,. |#\/\. |##|
|##|                                                   |'___.`\_/\/'/'.|##|
|##|                                       ,_.         `\#|-'_/|\/'/'/'|##|
|##|                                       `-'          `\| `-''/'/\/\.|##|
|##|,. ,_.                                               `'   `\\##\||||##|
|##||' `'\.                                                ,___/'\\#'/'|##|
|##|`'  `'',.                  ,.            ,.  ,_.   ,___/#/'-'#\'#\||##|
|##|  ,.   |'                ,_/'    ,.,.,_.,/\__/'|.,.|/\/\#|/\##\\##'|##|
|##|__/\.,_/\________________/\\_____/\/|/#\/\/\/\-'\/\/|#\/\\#/\|#-\#||##|
|##|/'\/'/#\#\\##\#\#\#\\#\#|#\#/\#\|\#|\##/\/'/\/'/#\#/\/'\#'#\#|###\||##|
|##\\//'/\/\|#/'-''-'##/-'\#'#\/'/#'\/|\/\\\/\###'#/\'-'\',/\|\/-'\\'/'|##|
|##\#\\/\/\#\#\/\/\/\##\/\###\#\#\#\/\\#\/##\#\##\#\/\__/\/\/\/\\\/##\\/##|
`\#######################################################################/'
 `-----------------------------------------------------------------------'


```

---

コード自身も溶かせる。

```
,. ,_________________. ,_____.                                        ,_____. ,
|| |######/\#########| |#####|                                        |#####| |
|| |######\/#########| |#####|                    ,_____.             |#####| |
|| |#####/-----------' |/\###|                    |#####|             |#####| |
|| |#####|             |\/###|                    |#####|             |#####| |
|| |#####|             |#####|                    `-----'             |#####| |
|| |#####|             |#####|                                       ,/#####| |
|| |#####|             |#####|                                       |######| |
|\.|#####\___________. |#####| ,_____.    ,_____. ,_____.     ,______/######|,/
`-'|#####/\######/\/\| |#####| |#####|    |#####| |#####|   ,_//\#######/\##||#
,_.|#####\/######\/\/| |#####| |#####|    |#/\##| |#/\##|  ,/#/\/##/--\#\/##||#
|#||#####/-----------' |#####| |###/\|    |#\/##| |#\/##| ,/##\/#/-'  |#####||#
|#||#####|             |#####| |###\/|    |#####| |#####| |#####/'    |#####||#
|#||#####|             |#####| |#####|    |#####| |#####| |#####|     |#####||#
|#||#####|             |#####| |#####|    |#####| |#####| |#####|     |#####||#
|#||#####|             |#####| |#####|    |#####| |#####| |#####|     |#####||#
|#||#####|             |#####| |#####\.   |#####| |#####| |#####\.    |#####||#
|#||#/\##|             |#####| `\#####\___/#####| |#####| `\#####\____/#####||#
|#||#\/\#|             |#####|  `\##/\##########| |#####|  `\###############||#
|#||##\/#|             |#####|   `-\\/##########| |#####|   `-\#######/\####||#
|#\//----'             `-----'     `------------' `-----'     `-------'`---\\/#
|###\______________________________________________________________________/###
|##############################################################################
`------------------------------------------------------------------------------


```

```
,.                                                                            ,
||                                                                            |
||     ,___.,____.                                                            |
||,____/---'`----\__.                                                         |
|||####\___.,____/##\.,____.,.                                      ,_.,_.,_. |
|||#####/--'`--------'`--'-'`\.                                   ,.|/'`-\//' |
|||##/\\\_.,_______________. `',_.                 ,.,.          ,/|`' ,_/\\. |
||/\#\/#/-'|#/----\#####|-\|   |/\_.            ,_.`'`',_.     ,_/\|  ,/\\/#\.|
|\/\\\##\__/#\____/#####| ||   ||`\|          ,_/-',.,.`-\_.  ,/''|| ,/\/##|'\/
`-'`\|\#\##\#\#######/\|' ||   || ||          |#|  ||||  |#|  ||  ||,/\/\#|' |#
,_.,/|\##\\#\###-\##\|`\. `\.  || `\.         `-\_.`'`',_/-' ,/\. |||\/\/-'  |#
|#|||\/|\#\#|\\#\/\|\| ||  ||  || ,/|           |#|,.,.|#|  ,/\#\_/\//\\\_.  |#
|#|`'/\\//\\\/##\\/||| ||  ||,_/\_/#\_. ,_. ,.,_/\\/\/\/\|,_/---\/\##\/\/'\. |#
|#|,/\#|\\/#\#/\##\\/\.|| ,/|||\###/-\\_/#|,/\/#||#\/\/\/||\#\__/\/###\/\_/| |#
|#|||'\\/\####\/###\##|||,/|\/\/###\.|##|\||\/\#||#/\/\/#\/##|\######\##\/\| |#
|#||| |#||###/-\##|\##|||||\/\|\/\##\/##\/||#\/\||#\/\#|\####||###\#|\#\#||| |#
|#|||,/|\/###\_/\#\/##||\/\/\/\/||##/\/\\#\/\#||||\#\/#\/##\#\/##\##\/###\/\.|#
|#||\//\/###\\/\######\/\||||\/\\/##\/\/|\\##/\/||#\########\###\\#|\|\#|\##||#
|#|/#\\/###\##\/\\###\#\/\/\/\\#\#\###\#\/\\#||#||\\##\\###\##\##\#\/\/#||#\||#
|#||\|###\#\#\\#/\\#\#\#\#\#\/\#\##|\##\##\##\//'|\\/\####/\#\##'\\##/\#\/##||#
|#\\/|\#\#\###\#\/\#'\|\#\/\##/\#\#'/###\#\#\#|\_/|#\/\\##\/\/\\\//\#\/\#\/\\/#
|###\\/\\#\#\#\\##\###\/\#\/\\\/\########\#\##\#\#\#####\\#\#\/###\/\#####\/###
`-\##########################################################################/-
  `--------------------------------------------------------------------------'



```

```
,.                                                                            ,
||                                                                            |
||                                                                            |
||          ,.                 ,.     ,.                                      |
||   ,.     `'                 `'     `'                                      |
||   `'                            ,___.                     ,.               |
||                                ,/'/'\_.,_.,.              `'           ,.  |
||  ,.                          ,.|/'\_/\|/#'/|      ,.          ,.       `'  |
|\.,/|.  ,.                   ,.`'|'\/---'#\#/'.,.   |\.         `'      ,.  ,/
`-'|-''  `' ,.             ,__/',_/\/|//\#\|/'/'/',.,//',.          ,.  ,/\. |#
,_.|-',_.   `'     ,_. ,___/'#'\//\#''-'##/'\|\/\||\/\|_/|___.,_.   ||. `\/' |#
|#|`\.|#'_. ,_. ,.,//'.|\/\|/#\/\\/'\/\/\\|'|'#'/'/#|||/\\/-''/\|,.,/''.,/'. |#
|#|,/\/''/'_/\\_/'/''/'/#'#|\'-'/\'--\/\/\|_/-\|/\#'\/'|\''|/#'-'/\/\.|'/'/' |#
|#||'||\/\//'\/''-'\\\/\-\/'#\\#\/'#|/'/\/'\\//'\/'\/'#\/'#|#'\#\\/''\/\\/',.|#
|#|/\/'/\/-\/\'/'\_/'\||\/'#-\\|\|/#'\'-'''`\/\/'\|||//\|/\\#\/\|\'/\/#\#''/'|#
|#|##|\|#'\/'/\\\/\\/\\/\\#\#\|\/'\\|/\'/\\_/'#\##'/\#|#'\#-\#|\|#'\####|\#|||#
|#|\''#'\\#\|##\#\#-\/|\#'\|##\#|/#\\##\##/\#/'#\\#''\\#\#'\#\'\\#\/\/-\\#'\||#
|#|/#|/'\#\/\#\#\#|\/-'#\|#|\#-''##\|\#|\\|-'\#\\#''\/'##'\'\/'#'#\/''\/''\/'|#
|#|\''\\/'||/'-\|'\#'##\#\#|\''\|\'#|#\'#/'\##|#-''\/\##'|###'/\#'#|\/#\/\#' |#
|#|#'|/''|'\/\##'--'\/'-'--'#'##'/#-'\#\-\#|##|\\/'#'--'#'\#|#'\\\/'\/\/'\'' |#
|#\#|\|/'`'\\/'''\|\#'/\|\/\|\#'\'\|/''-'-'|\-'/-'\|\/#''|#-'/\/'-'/-'-''-',_/#
|###\/\#\__/#\___/\/\\\/\#\#\##\/\/\\_/##\#\#\\\\\/\/#\\/\#\#\/\__/\/\_____/###
`-\##########################################################################/-
  `--------------------------------------------------------------------------'


```

---

作者自身によるデモ動画。

{% include youtube.html src="QMYfkOtYYlg" desc="作者によるデモ動画" %}

## 解説

[SPH法](https://ja.wikipedia.org/wiki/Smoothed_Particle_Hydrodynamics)による流体シミュレーション。
流体を粒の集まりとし、粒同士の圧力と粘性をシミュレーションすることで流体の動きを表現する。
表示には[マーチングスクエア法](https://ja.wikipedia.org/wiki/%E3%83%9E%E3%83%BC%E3%83%81%E3%83%B3%E3%82%B0%E3%82%AD%E3%83%A5%E3%83%BC%E3%83%96%E6%B3%95)を用いる。

初期配置は80x24のテキストとして与える。
`#`の位置の粒子は固定（壁）、それ以外の非空白文字は動く粒子とみなす。
コンパイルオプションの`-DG=1 -DP=4 -DV=8`はそれぞれ、重力、粒子同士の圧力、粒子同士の粘性の強さを表す。

動作例で示したとおり、コード形状はシミュレーションの初期配置になっている。
`#`を固定粒子としたのは`#include`をそのまま利用するため。

実装上の特徴としては、C99で導入された[`complex`型](https://ja.wikipedia.org/wiki/%E8%A4%87%E7%B4%A0%E6%95%B0%E5%9E%8B)を活用して2次元ベクトルを表現している。
なお、直感とちがい、実数方向が縦、虚数方向が横。
これにより、重力を計算するとき`force += G * I`ではなく`force += G`で済む。
`double complex a[]`は5要素で1粒子を表現していて、それぞれ位置ベクトル、固定フラグ、密度、力、粘性を表す。

審査員コメントにある[Jeopardy!](https://ja.wikipedia.org/wiki/%E3%82%B8%E3%82%A7%E3%83%91%E3%83%87%E3%82%A3!)は、アメリカの古いクイズ番組。
問題の解答を聞いて、問題文を当てる。

> 「答え：複素数を扱い、ASCIIグラフィックスアニメーションする難読化されたプログラム。」
> 「問題：マンデルブロシミュレータ？」
> ブー。

賞名の"complex"は、「複雑な」と「複素数」をかけている。

審査員はこのプログラムの挙動をはじめて見たとき、"[Wow!](https://twitter.com/ioccc/status/247140812683628545)"とツイートしたとのこと。
