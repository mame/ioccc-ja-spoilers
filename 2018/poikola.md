---
id: 2018/poikola
year: 2018
order: 12
authors: "Timo_Poikola"
orig_url: "https://www.ioccc.org/2018/poikola/prog.c"
hint_url: "https://www.ioccc.org/2018/poikola/hint.html"
title: "IOCCC 2018: Most stellar"
award_ja: "もっとも輝かしい"
---

## 動作

北斗七星のアニメーションをする。

```
$ gcc -o prog prog.c

$ ./prog
```

{% include img.html src="2018-poikola.png" desc="実行終了した様子" %}

端末の24ビットカラーの機能を使って、なるべく実際の星の色に近い色で表示される。

## 解説

天文学者の[アニー・ジャンプ・キャノン](https://ja.wikipedia.org/wiki/%E3%82%A2%E3%83%8B%E3%83%BC%E3%83%BB%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E3%83%BB%E3%82%AD%E3%83%A3%E3%83%8E%E3%83%B3)が行った[スペクトル分類](https://ja.wikipedia.org/wiki/%E3%82%B9%E3%83%9A%E3%82%AF%E3%83%88%E3%83%AB%E5%88%86%E9%A1%9E)にしたがって色付きで北斗七星をアニメーションする。

審査員がコメントで書いている"Oh, Be A Fine Gal/Gentlemen, Kiss Me!"は、スペクトル分類のO、B、A、F、G、K、Mを暗記するためのフレーズ。

[Fletcher-16のチェックサムアルゴリズム](https://ja.wikipedia.org/wiki/%E3%83%95%E3%83%AC%E3%83%83%E3%83%81%E3%83%A3%E3%83%BC%E3%81%AE%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%B5%E3%83%A0)で自分自身を検証するので、下手にソースコードを編集すると動かなくなる。
とは言え、`fopen(__FILE__)`しているだけなので、一旦プリプロセスを通したソースコードを作ってしまえば回避できる。

復活祭（イースターの日）に実行すると最後に"Lets find some Easter eggs"というメッセージが出る。
時計を変えなくても、プリプロセスしたソースコードを編集して`time_t j = 1522584000;`とすれば確認できる。

コードは星型形状。
`__ATOMIC_SEQ_CST`のような定数を無意味に利用してわかりにくくしている。
Pascal風に`begin;`と`end;`で書きたかったが、サイズの都合上`B`/`E`のマクロになっている。
`printf()`は`$`のマクロになっている。
47行目の巨大な`float`型の数字は、IEEE 754の浮動小数点数を文字列として解釈すると、起動直後のメッセージになっていることがわかる。

```
$ ruby -e 'p [4612954808543207739097088.0, 207.285645, 214354950132336733650542884425029386240.0].pack("f3")'
"25th IOCCC!\x7F"
```

このプログラムには少なくとも3つの機能がある、とされているが、これはちょっと明確にはわからない。
北斗七星の描画、復活祭の日の判定、チェックサムアルゴリズム、でよいのだろうか。
